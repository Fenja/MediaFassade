// Generated by CoffeeScript 1.9.3

/*

The compiled custom_body.js will be included at the end of the html body section after the include of socket.io and stk-framework.
Define your functions here.
 */


/* Define your handler */

(function() {
  var direction, draggable_background_handler, draggable_image_handler, draggable_joystick_handler, handle;

  draggable_background_handler = function(msg) {
    return console.log('Do something with msg: ' + JSON.stringify(msg));
  };

  draggable_image_handler = function(msg) {
    return console.log('Do something with msg: ' + JSON.stringify(msg));
  };

  draggable_joystick_handler = function(msg) {
    handle(direction(msg), msg.id);
    return console.log('Do something with msg: ' + JSON.stringify(msg));
  };


  /* Register your handler */

  stk.framework.register_handler('draggable_background', draggable_background_handler);

  stk.framework.register_handler('draggable_image', draggable_image_handler);

  stk.framework.register_handler('draggable_joystick', draggable_joystick_handler);


  /* Debug handler to test without remote control */

  window.onkeydown = function(e) {
    var ascii, code;
    code = e.keyCode ? e.keyCode : e.which;
    ascii = e.charCode ? e.charCode : e.which;
    if (code === 37) {
      return handle("left", 0);
    } else if (code === 38) {
      return handle("up", 0);
    } else if (code === 39) {
      return handle("right", 0);
    } else if (ascii === 65) {
      return handle("left", 1);
    } else if (ascii === 87) {
      return handle("up", 1);
    } else if (ascii === 68) {
      return handle("right", 1);
    }
  };


  /* Own methods */

  direction = function(msg) {
    var dir, type, x, y;
    x = msg.x;
    y = msg.y;
    type = msg.type;
    dir = "none";
    if (y < 0.4 && y < x - 0.1) {
      dir = "up";
    } else if (y > 0.6 && y > x + 0.1) {
      dir = "down";
    } else if (x < 0.4 && x < y - 0.1) {
      dir = "left";
    } else if (x > 0.6 && x > y + 0.1) {
      dir = "right";
    }
    return dir;
  };

  handle = function(dir, id) {
    var player, position;
    player = document.getElementById('player' + id);
    position = parseInt(getComputedStyle(player).left);
    if (dir === "left" && position > 0) {
      position -= 10;
    } else if (dir === "right" && position < window.innerWidth) {
      position += 10;
    }
    player.style.left = position + "px";
    return document.getElementById('output').innerHTML = dir + " " + position;
  };

}).call(this);
